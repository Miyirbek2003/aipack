function getURLVar(key){var value=[];var query=String(document.location).split('?');if(query[1]){var part=query[1].split('&');for(i=0;i<part.length;i++){var data=part[i].split('=');if(data[0]&&data[1]){value[data[0]]=data[1];}}if(value[key]){return value[key];}else{return'';}}}$(document).ready(function(){$('.text-danger').each(function(){var element=$(this).parent().parent();if(element.hasClass('form-group')){element.addClass('has-error');}});$('#search input[name=\'search\']').parent().find('button').on('click',function(){url=$('base').attr('href')+'index.php?route=product/search';var value=$('header input[name=\'search\']').val();if(value){url+='&search='+encodeURIComponent(value);}location=url;});$('#search input[name=\'search\']').on('keydown',function(e){if(e.keyCode==13){$('header input[name=\'search\']').parent().find('button').trigger('click');}});if($('.hidden-xs').is(":visible")){$(".nav.navbar-nav > li").one('mouseover click',function(e){if(($('ul',this).length)&&(!$('ul:first',this).hasClass('opened'))){var elm=$('ul:first',this);elm.show();var off=elm.offset();var l=off.left;var w=elm.width();elm.hide();elm.addClass('opened');var docW=$(".container").width();var isEntirelyVisible=(l+w<=docW);if(!isEntirelyVisible){elm.addClass('pull-right');}else{elm.removeClass('pull-right');}}});$('.dropdown').on('show.bs.dropdown',function(e){$(this).find('.dropdown-menu').first().stop(true,true).fadeIn(250);});$('.dropdown').on('hide.bs.dropdown',function(e){e.preventDefault();$(this).find('.dropdown-menu').first().stop(true,true).fadeOut(250,function(){$(this).parent().removeClass('open');});});}else{$('.dropdown').on('show.bs.dropdown',function(e){$(this).find('.dropdown-menu').first().stop(true,true).slideDown(300);});$('.dropdown').on('hide.bs.dropdown',function(e){e.preventDefault();$(this).find('.dropdown-menu').first().stop(true,true).slideUp(300,function(){$(this).parent().removeClass('open');});});}$('#list-view').click(function(){$('#content .product-grid > .clearfix').remove();$('#content .row.products > .product-grid').attr('class','product-layout product-list');$('#list-view').addClass('active');$('#grid-view').removeClass('active');localStorage.setItem('display','list');});$('#grid-view').click(function(){cols=$('#column-right, #column-left').length;if(cols==2){$('#content .row.products > .product-list').attr('class','product-layout product-grid');}else if(cols==1){$('#content .row.products > .product-list').attr('class','product-layout product-grid');}else{$('#content .row.products > .product-list').attr('class','product-layout product-grid');}$('#grid-view').addClass('active');$('#list-view').removeClass('active');localStorage.setItem('display','grid');});if(localStorage.getItem('display')=='list'){$('#list-view').trigger('click');$('#list-view').addClass('active');$('#grid-view').removeClass('active');}else if(localStorage.getItem('display')=='grid'){$('#grid-view').trigger('click');$('#grid-view').addClass('active');$('#list-view').removeClass('active');}$(document).on('keydown','#collapse-checkout-option input[name=\'email\'], #collapse-checkout-option input[name=\'password\']',function(e){if(e.keyCode==13){$('#collapse-checkout-option #button-login').trigger('click');}});$('[data-toggle="tooltip"]').tooltip({trigger:'hover',container:'body'});$('.sticker [data-toggle=\'tooltip\']').tooltip({container:'body'});$('.btn, .btn > span').click(function(){$(this).tooltip('hide');});if(!('ontouchstart'in window)){$('[data-toggle=\'tooltip\']').tooltip({container:'body'});$(document).ajaxStop(function(){$('[data-toggle=\'tooltip\']').tooltip({container:'body'});});}$(document).on('click','.dropdown-menu',function(e){$(this).hasClass('keep-open')&&e.stopPropagation();});$("#cart button").click(function(){$("#cart > .dropdown-toggle").dropdown("toggle");});$('#infoModal').on('show.bs.modal',function(event){var button=$(event.relatedTarget);var description=button.data('info-description');var title=button.data('info-title');var modal=$(this);if(description){modal.find('.modal-body').load('index.php?route=information/information/agree&information_id='+description);}})});var cart={'add':function(product_id,quantity){$.ajax({url:'index.php?route=checkout/cart/add',type:'post',data:'product_id='+product_id+'&quantity='+(typeof(quantity)!='undefined'?quantity:1),dataType:'json',beforeSend:function(){$('#cart > button').button('loading');},complete:function(){$('#cart > button').button('reset');},success:function(json){$('.alert, .text-danger').remove();if(json['redirect']){location=json['redirect'];}if(json['success']){setTimeout(function(){var myString=json['total'];var substringArray=myString.split("товар(ов)");var arrayLimited=$.trim(myString.split("товар(ов)",1));$('#cart > .dropdown-toggle #cart-total').html(arrayLimited);},100);$('#cart > ul').load('index.php?route=common/cart/info ul li');$('#popupModal').find('.modal-body').load('index.php?route=common/cart/info ul',function(){$('#popupModal .modal-header .close').addClass('hidden');$('#popupModal .modal-body > ul').removeClass('dropdown-menu keep-open');$('#popupModal .modal-body > ul').addClass('list-unstyled');$('#popupModal .modal-footer .btn-shopping').removeClass('hidden');$('#popupModal .modal-footer .btn-back').addClass('hidden');$('#popupModal .modal-body .btn-primary').parent().parent().prepend('<div class="panel panel-info"><div class="panel-heading text-center"><small>'+json['success']+'</small></div></div>');$('#popupModal').find('.modal-title').load('index.php?route=common/cart/info #cart-total',function(){$('#popupModal').modal();});});}},error:function(xhr,ajaxOptions,thrownError){alert(thrownError+"\r\n"+xhr.statusText+"\r\n"+xhr.responseText);}});},'update':function(key,quantity){$.ajax({url:'index.php?route=checkout/cart/edit',type:'post',data:'key='+key+'&quantity='+(typeof(quantity)!='undefined'?quantity:1),dataType:'json',beforeSend:function(){$('#cart > button').button('loading');},complete:function(){$('#cart > button').button('reset');},success:function(json){setTimeout(function(){$('#cart > .dropdown-toggle #cart-total').html('упс');alert('упс');},100);if(getURLVar('route')=='checkout/cart'||getURLVar('route')=='checkout/checkout'){location='index.php?route=checkout/cart';}else{$('#cart > ul').load('index.php?route=common/cart/info ul li');if($('body').hasClass('modal-open')){$('#popupModal').find('.modal-body ul').load('index.php?route=common/cart/info ul li',function(){$('#popupModal').find('.modal-title').load('index.php?route=common/cart/info #cart-total',function(){$('#popupModal').modal();});});}}},error:function(xhr,ajaxOptions,thrownError){alert(thrownError+"\r\n"+xhr.statusText+"\r\n"+xhr.responseText);}});},'remove':function(key){$.ajax({url:'index.php?route=checkout/cart/remove',type:'post',data:'key='+key,dataType:'json',beforeSend:function(){},complete:function(){},success:function(json){setTimeout(function(){var count_cart_total_mini;count_cart_total_mini=$('#cart > .dropdown-toggle #cart-total').html();$('#cart > .dropdown-toggle .hidden-md').load('index.php?route=common/cart/info #cart-total');},100);if(getURLVar('route')=='checkout/cart'||getURLVar('route')=='checkout/checkout'){location='index.php?route=checkout/cart';}else{$('#cart > ul').load('index.php?route=common/cart/info ul li');if($('body').hasClass('modal-open')){$('#popupModal').find('.modal-body ul').load('index.php?route=common/cart/info ul li',function(){$('#popupModal').find('.modal-title').load('index.php?route=common/cart/info #cart-total',function(){$('#popupModal').modal();});});}}},error:function(xhr,ajaxOptions,thrownError){alert(thrownError+"\r\n"+xhr.statusText+"\r\n"+xhr.responseText);}});}}
var voucher={'add':function(){},'remove':function(key){$.ajax({url:'index.php?route=checkout/cart/remove',type:'post',data:'key='+key,dataType:'json',beforeSend:function(){$('#cart > button').button('loading');},complete:function(){$('#cart > button').button('reset');},success:function(json){setTimeout(function(){$('#cart > .dropdown-toggle #cart-total').html(json['total']);},100);if(getURLVar('route')=='checkout/cart'||getURLVar('route')=='checkout/checkout'){location='index.php?route=checkout/cart';}else{$('#cart > ul').load('index.php?route=common/cart/info ul li');if($('body').hasClass('modal-open')){$('#popupModal').find('.modal-body ul').load('index.php?route=common/cart/info ul li',function(){$('#popupModal').find('.modal-title').load('index.php?route=common/cart/info #cart-total',function(){$('#popupModal').modal();});});}}},error:function(xhr,ajaxOptions,thrownError){alert(thrownError+"\r\n"+xhr.statusText+"\r\n"+xhr.responseText);}});}}
var wishlist={'add':function(product_id){$.ajax({url:'index.php?route=account/wishlist/add',type:'post',data:'product_id='+product_id,dataType:'json',success:function(json){$('.alert').remove();if(json['redirect']){location=json['redirect'];}if(json['success']){$('#popupModal .modal-body').empty();var title=$('#popupModal .modal-header > div.hidden').data('wishlist-title');var link=$('#popupModal .modal-header > div.hidden').data('wishlist-link');$('#popupModal .modal-header .close').removeClass('hidden');$('#popupModal .modal-title').text(title);$('#popupModal .modal-footer .btn-shopping').removeClass('hidden');$('#popupModal .modal-footer .btn-back').addClass('hidden');$('#popupModal .modal-body').prepend('<div class="buttons"><p class="text-center"><a href="'+link+'" class="btn btn-primary"><i class="fa fa-fw fa-heart"></i> '+json['total']+'</a></p></div>');$('#popupModal .modal-body').prepend('<div class="panel panel-info"><div class="panel-heading text-center"><small>'+json['success']+'</small></div></div>');$('#popupModal').modal();}$('#wishlist-total span').html(json['total']);$('#wishlist-total').attr('title',json['total']);},error:function(xhr,ajaxOptions,thrownError){alert(thrownError+"\r\n"+xhr.statusText+"\r\n"+xhr.responseText);}});},'remove':function(){}}
var compare={'add':function(product_id){$.ajax({url:'index.php?route=product/compare/add',type:'post',data:'product_id='+product_id,dataType:'json',success:function(json){$('.alert').remove();if(json['success']){$('#compare-total').html(json['total']);$('#popupModal .modal-body').empty();var title=$('#popupModal .modal-header > div.hidden').data('compare-title');var link=$('#popupModal .modal-header > div.hidden').data('compare-link');$('#popupModal .modal-header .close').removeClass('hidden');$('#popupModal .modal-title').text(title);$('#popupModal .modal-footer .btn-shopping').removeClass('hidden');$('#popupModal .modal-footer .btn-back').addClass('hidden');$('#popupModal .modal-body').prepend('<div class="buttons"><p class="text-center"><a href="'+link+'" class="btn btn-primary"><i class="fa fa-fw fa-area-chart"></i> '+json['total']+'</a></p></div>');$('#popupModal .modal-body').prepend('<div class="panel panel-info"><div class="panel-heading text-center"><small>'+json['success']+'</small></div></div>');$('#popupModal').modal();}},error:function(xhr,ajaxOptions,thrownError){alert(thrownError+"\r\n"+xhr.statusText+"\r\n"+xhr.responseText);}});},'remove':function(){}}
$(document).delegate('.agree','click',function(e){e.preventDefault();$('#modal-agree').remove();var element=this;$.ajax({url:$(element).attr('href'),type:'get',dataType:'html',success:function(data){html='<div id="modal-agree" class="modal">';html+='  <div class="modal-dialog">';html+='    <div class="modal-content">';html+='      <div class="modal-header">';html+='        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>';html+='        <h4 class="modal-title">'+$(element).text()+'</h4>';html+='      </div>';html+='      <div class="modal-body">'+data+'</div>';html+='    </div';html+='  </div>';html+='</div>';$('body').append(html);$('#modal-agree').modal('show');}});});(function($){$.fn.autocomplete=function(option){return this.each(function(){this.timer=null;this.items=new Array();$.extend(this,option);$(this).attr('autocomplete','off');$(this).on('focus',function(){this.request();});$(this).on('blur',function(){setTimeout(function(object){object.hide();},200,this);});$(this).on('keydown',function(event){switch(event.keyCode){case 27:this.hide();break;default:this.request();break;}});this.click=function(event){event.preventDefault();value=$(event.target).parent().attr('data-value');if(value&&this.items[value]){this.select(this.items[value]);}}
this.show=function(){var pos=$(this).position();$(this).siblings('ul.dropdown-menu').css({top:pos.top+$(this).outerHeight(),left:pos.left});$(this).siblings('ul.dropdown-menu').show();}
this.hide=function(){$(this).siblings('ul.dropdown-menu').hide();}
this.request=function(){clearTimeout(this.timer);this.timer=setTimeout(function(object){object.source($(object).val(),$.proxy(object.response,object));},200,this);}
this.response=function(json){html='';if(json.length){for(i=0;i<json.length;i++){this.items[json[i]['value']]=json[i];}for(i=0;i<json.length;i++){if(!json[i]['category']){html+='<li data-value="'+json[i]['value']+'"><a href="#">'+json[i]['label']+'</a></li>';}}var category=new Array();for(i=0;i<json.length;i++){if(json[i]['category']){if(!category[json[i]['category']]){category[json[i]['category']]=new Array();category[json[i]['category']]['name']=json[i]['category'];category[json[i]['category']]['item']=new Array();}category[json[i]['category']]['item'].push(json[i]);}}for(i in category){html+='<li class="dropdown-header">'+category[i]['name']+'</li>';for(j=0;j<category[i]['item'].length;j++){html+='<li data-value="'+category[i]['item'][j]['value']+'"><a href="#">&nbsp;&nbsp;&nbsp;'+category[i]['item'][j]['label']+'</a></li>';}}}if(html){this.show();}else{this.hide();}$(this).siblings('ul.dropdown-menu').html(html);}
$(this).after('<ul class="dropdown-menu"></ul>');$(this).siblings('ul.dropdown-menu').delegate('a','click',$.proxy(this.click,this));});}})(window.jQuery);